{"version":3,"file":"index.js","sources":["../node_modules/dotenv/lib/main.js","../node_modules/dotenv/config.js","../node_modules/dotenv/lib/env-options.js","../node_modules/dotenv/lib/cli-options.js","../src/services/data-service.ts","../src/controllers/email-controller.ts","../src/routes/email-route.ts","../src/controllers/registration-controller.ts","../src/routes/registration-route.ts","../src/index.ts"],"sourcesContent":["const fs = require('fs')\nconst path = require('path')\nconst os = require('os')\nconst crypto = require('crypto')\nconst packageJson = require('../package.json')\n\nconst version = packageJson.version\n\nconst LINE = /(?:^|^)\\s*(?:export\\s+)?([\\w.-]+)(?:\\s*=\\s*?|:\\s+?)(\\s*'(?:\\\\'|[^'])*'|\\s*\"(?:\\\\\"|[^\"])*\"|\\s*`(?:\\\\`|[^`])*`|[^#\\r\\n]+)?\\s*(?:#.*)?(?:$|$)/mg\n\n// Parse src into an Object\nfunction parse (src) {\n  const obj = {}\n\n  // Convert buffer to string\n  let lines = src.toString()\n\n  // Convert line breaks to same format\n  lines = lines.replace(/\\r\\n?/mg, '\\n')\n\n  let match\n  while ((match = LINE.exec(lines)) != null) {\n    const key = match[1]\n\n    // Default undefined or null to empty string\n    let value = (match[2] || '')\n\n    // Remove whitespace\n    value = value.trim()\n\n    // Check if double quoted\n    const maybeQuote = value[0]\n\n    // Remove surrounding quotes\n    value = value.replace(/^(['\"`])([\\s\\S]*)\\1$/mg, '$2')\n\n    // Expand newlines if double quoted\n    if (maybeQuote === '\"') {\n      value = value.replace(/\\\\n/g, '\\n')\n      value = value.replace(/\\\\r/g, '\\r')\n    }\n\n    // Add to object\n    obj[key] = value\n  }\n\n  return obj\n}\n\nfunction _parseVault (options) {\n  const vaultPath = _vaultPath(options)\n\n  // Parse .env.vault\n  const result = DotenvModule.configDotenv({ path: vaultPath })\n  if (!result.parsed) {\n    const err = new Error(`MISSING_DATA: Cannot parse ${vaultPath} for an unknown reason`)\n    err.code = 'MISSING_DATA'\n    throw err\n  }\n\n  // handle scenario for comma separated keys - for use with key rotation\n  // example: DOTENV_KEY=\"dotenv://:key_1234@dotenvx.com/vault/.env.vault?environment=prod,dotenv://:key_7890@dotenvx.com/vault/.env.vault?environment=prod\"\n  const keys = _dotenvKey(options).split(',')\n  const length = keys.length\n\n  let decrypted\n  for (let i = 0; i < length; i++) {\n    try {\n      // Get full key\n      const key = keys[i].trim()\n\n      // Get instructions for decrypt\n      const attrs = _instructions(result, key)\n\n      // Decrypt\n      decrypted = DotenvModule.decrypt(attrs.ciphertext, attrs.key)\n\n      break\n    } catch (error) {\n      // last key\n      if (i + 1 >= length) {\n        throw error\n      }\n      // try next key\n    }\n  }\n\n  // Parse decrypted .env string\n  return DotenvModule.parse(decrypted)\n}\n\nfunction _log (message) {\n  console.log(`[dotenv@${version}][INFO] ${message}`)\n}\n\nfunction _warn (message) {\n  console.log(`[dotenv@${version}][WARN] ${message}`)\n}\n\nfunction _debug (message) {\n  console.log(`[dotenv@${version}][DEBUG] ${message}`)\n}\n\nfunction _dotenvKey (options) {\n  // prioritize developer directly setting options.DOTENV_KEY\n  if (options && options.DOTENV_KEY && options.DOTENV_KEY.length > 0) {\n    return options.DOTENV_KEY\n  }\n\n  // secondary infra already contains a DOTENV_KEY environment variable\n  if (process.env.DOTENV_KEY && process.env.DOTENV_KEY.length > 0) {\n    return process.env.DOTENV_KEY\n  }\n\n  // fallback to empty string\n  return ''\n}\n\nfunction _instructions (result, dotenvKey) {\n  // Parse DOTENV_KEY. Format is a URI\n  let uri\n  try {\n    uri = new URL(dotenvKey)\n  } catch (error) {\n    if (error.code === 'ERR_INVALID_URL') {\n      const err = new Error('INVALID_DOTENV_KEY: Wrong format. Must be in valid uri format like dotenv://:key_1234@dotenvx.com/vault/.env.vault?environment=development')\n      err.code = 'INVALID_DOTENV_KEY'\n      throw err\n    }\n\n    throw error\n  }\n\n  // Get decrypt key\n  const key = uri.password\n  if (!key) {\n    const err = new Error('INVALID_DOTENV_KEY: Missing key part')\n    err.code = 'INVALID_DOTENV_KEY'\n    throw err\n  }\n\n  // Get environment\n  const environment = uri.searchParams.get('environment')\n  if (!environment) {\n    const err = new Error('INVALID_DOTENV_KEY: Missing environment part')\n    err.code = 'INVALID_DOTENV_KEY'\n    throw err\n  }\n\n  // Get ciphertext payload\n  const environmentKey = `DOTENV_VAULT_${environment.toUpperCase()}`\n  const ciphertext = result.parsed[environmentKey] // DOTENV_VAULT_PRODUCTION\n  if (!ciphertext) {\n    const err = new Error(`NOT_FOUND_DOTENV_ENVIRONMENT: Cannot locate environment ${environmentKey} in your .env.vault file.`)\n    err.code = 'NOT_FOUND_DOTENV_ENVIRONMENT'\n    throw err\n  }\n\n  return { ciphertext, key }\n}\n\nfunction _vaultPath (options) {\n  let possibleVaultPath = null\n\n  if (options && options.path && options.path.length > 0) {\n    if (Array.isArray(options.path)) {\n      for (const filepath of options.path) {\n        if (fs.existsSync(filepath)) {\n          possibleVaultPath = filepath.endsWith('.vault') ? filepath : `${filepath}.vault`\n        }\n      }\n    } else {\n      possibleVaultPath = options.path.endsWith('.vault') ? options.path : `${options.path}.vault`\n    }\n  } else {\n    possibleVaultPath = path.resolve(process.cwd(), '.env.vault')\n  }\n\n  if (fs.existsSync(possibleVaultPath)) {\n    return possibleVaultPath\n  }\n\n  return null\n}\n\nfunction _resolveHome (envPath) {\n  return envPath[0] === '~' ? path.join(os.homedir(), envPath.slice(1)) : envPath\n}\n\nfunction _configVault (options) {\n  _log('Loading env from encrypted .env.vault')\n\n  const parsed = DotenvModule._parseVault(options)\n\n  let processEnv = process.env\n  if (options && options.processEnv != null) {\n    processEnv = options.processEnv\n  }\n\n  DotenvModule.populate(processEnv, parsed, options)\n\n  return { parsed }\n}\n\nfunction configDotenv (options) {\n  const dotenvPath = path.resolve(process.cwd(), '.env')\n  let encoding = 'utf8'\n  const debug = Boolean(options && options.debug)\n\n  if (options && options.encoding) {\n    encoding = options.encoding\n  } else {\n    if (debug) {\n      _debug('No encoding is specified. UTF-8 is used by default')\n    }\n  }\n\n  let optionPaths = [dotenvPath] // default, look for .env\n  if (options && options.path) {\n    if (!Array.isArray(options.path)) {\n      optionPaths = [_resolveHome(options.path)]\n    } else {\n      optionPaths = [] // reset default\n      for (const filepath of options.path) {\n        optionPaths.push(_resolveHome(filepath))\n      }\n    }\n  }\n\n  // Build the parsed data in a temporary object (because we need to return it).  Once we have the final\n  // parsed data, we will combine it with process.env (or options.processEnv if provided).\n  let lastError\n  const parsedAll = {}\n  for (const path of optionPaths) {\n    try {\n      // Specifying an encoding returns a string instead of a buffer\n      const parsed = DotenvModule.parse(fs.readFileSync(path, { encoding }))\n\n      DotenvModule.populate(parsedAll, parsed, options)\n    } catch (e) {\n      if (debug) {\n        _debug(`Failed to load ${path} ${e.message}`)\n      }\n      lastError = e\n    }\n  }\n\n  let processEnv = process.env\n  if (options && options.processEnv != null) {\n    processEnv = options.processEnv\n  }\n\n  DotenvModule.populate(processEnv, parsedAll, options)\n\n  if (lastError) {\n    return { parsed: parsedAll, error: lastError }\n  } else {\n    return { parsed: parsedAll }\n  }\n}\n\n// Populates process.env from .env file\nfunction config (options) {\n  // fallback to original dotenv if DOTENV_KEY is not set\n  if (_dotenvKey(options).length === 0) {\n    return DotenvModule.configDotenv(options)\n  }\n\n  const vaultPath = _vaultPath(options)\n\n  // dotenvKey exists but .env.vault file does not exist\n  if (!vaultPath) {\n    _warn(`You set DOTENV_KEY but you are missing a .env.vault file at ${vaultPath}. Did you forget to build it?`)\n\n    return DotenvModule.configDotenv(options)\n  }\n\n  return DotenvModule._configVault(options)\n}\n\nfunction decrypt (encrypted, keyStr) {\n  const key = Buffer.from(keyStr.slice(-64), 'hex')\n  let ciphertext = Buffer.from(encrypted, 'base64')\n\n  const nonce = ciphertext.subarray(0, 12)\n  const authTag = ciphertext.subarray(-16)\n  ciphertext = ciphertext.subarray(12, -16)\n\n  try {\n    const aesgcm = crypto.createDecipheriv('aes-256-gcm', key, nonce)\n    aesgcm.setAuthTag(authTag)\n    return `${aesgcm.update(ciphertext)}${aesgcm.final()}`\n  } catch (error) {\n    const isRange = error instanceof RangeError\n    const invalidKeyLength = error.message === 'Invalid key length'\n    const decryptionFailed = error.message === 'Unsupported state or unable to authenticate data'\n\n    if (isRange || invalidKeyLength) {\n      const err = new Error('INVALID_DOTENV_KEY: It must be 64 characters long (or more)')\n      err.code = 'INVALID_DOTENV_KEY'\n      throw err\n    } else if (decryptionFailed) {\n      const err = new Error('DECRYPTION_FAILED: Please check your DOTENV_KEY')\n      err.code = 'DECRYPTION_FAILED'\n      throw err\n    } else {\n      throw error\n    }\n  }\n}\n\n// Populate process.env with parsed values\nfunction populate (processEnv, parsed, options = {}) {\n  const debug = Boolean(options && options.debug)\n  const override = Boolean(options && options.override)\n\n  if (typeof parsed !== 'object') {\n    const err = new Error('OBJECT_REQUIRED: Please check the processEnv argument being passed to populate')\n    err.code = 'OBJECT_REQUIRED'\n    throw err\n  }\n\n  // Set process.env\n  for (const key of Object.keys(parsed)) {\n    if (Object.prototype.hasOwnProperty.call(processEnv, key)) {\n      if (override === true) {\n        processEnv[key] = parsed[key]\n      }\n\n      if (debug) {\n        if (override === true) {\n          _debug(`\"${key}\" is already defined and WAS overwritten`)\n        } else {\n          _debug(`\"${key}\" is already defined and was NOT overwritten`)\n        }\n      }\n    } else {\n      processEnv[key] = parsed[key]\n    }\n  }\n}\n\nconst DotenvModule = {\n  configDotenv,\n  _configVault,\n  _parseVault,\n  config,\n  decrypt,\n  parse,\n  populate\n}\n\nmodule.exports.configDotenv = DotenvModule.configDotenv\nmodule.exports._configVault = DotenvModule._configVault\nmodule.exports._parseVault = DotenvModule._parseVault\nmodule.exports.config = DotenvModule.config\nmodule.exports.decrypt = DotenvModule.decrypt\nmodule.exports.parse = DotenvModule.parse\nmodule.exports.populate = DotenvModule.populate\n\nmodule.exports = DotenvModule\n","(function () {\n  require('./lib/main').config(\n    Object.assign(\n      {},\n      require('./lib/env-options'),\n      require('./lib/cli-options')(process.argv)\n    )\n  )\n})()\n","// ../config.js accepts options via environment variables\nconst options = {}\n\nif (process.env.DOTENV_CONFIG_ENCODING != null) {\n  options.encoding = process.env.DOTENV_CONFIG_ENCODING\n}\n\nif (process.env.DOTENV_CONFIG_PATH != null) {\n  options.path = process.env.DOTENV_CONFIG_PATH\n}\n\nif (process.env.DOTENV_CONFIG_DEBUG != null) {\n  options.debug = process.env.DOTENV_CONFIG_DEBUG\n}\n\nif (process.env.DOTENV_CONFIG_OVERRIDE != null) {\n  options.override = process.env.DOTENV_CONFIG_OVERRIDE\n}\n\nif (process.env.DOTENV_CONFIG_DOTENV_KEY != null) {\n  options.DOTENV_KEY = process.env.DOTENV_CONFIG_DOTENV_KEY\n}\n\nmodule.exports = options\n","const re = /^dotenv_config_(encoding|path|debug|override|DOTENV_KEY)=(.+)$/\n\nmodule.exports = function optionMatcher (args) {\n  return args.reduce(function (acc, cur) {\n    const matches = cur.match(re)\n    if (matches) {\n      acc[matches[1]] = matches[2]\n    }\n    return acc\n  }, {})\n}\n","/**\n * @copyright Copyright (c) 2025 Christian Silfang\n */\n\nimport { randomUUID } from 'crypto';\nimport fs from 'fs';\nimport path from 'path';\nimport { fileURLToPath } from 'url';\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = path.dirname(__filename);\n\nconst dataDir = path.join(__dirname, '..', 'data');\nconst dataFile = path.join(dataDir, 'registrations.ndjson');\n\nif (!fs.existsSync(dataDir)) {\n    fs.mkdirSync(dataDir, { recursive: true });\n}\n\n/**\n * Speichert ein Datenobjekt in der NDJSON-Datei.\n * @param type Der Typ des Datensatzes (z.B. 'email-contact', 'course-registration').\n * @param data Das zu speichernde Objekt.\n * @returns Das gespeicherte Objekt mit einer generierten ID.\n */\nexport const saveData = async (type: string, data: object): Promise<any> => {\n    const record = {\n        id: randomUUID(),\n        type,\n        timestamp: new Date().toISOString(),\n        ...data,\n    };\n\n    const line = JSON.stringify(record) + '\\n';\n\n    try {\n        await fs.promises.appendFile(dataFile, line);\n        return record;\n    } catch (error) {\n        console.error('Fehler beim Speichern der Daten:', error);\n        throw new Error('Daten konnten nicht gespeichert werden.');\n    }\n};\n\n/**\n * Liest alle Registrierungen aus der NDJSON-Datei.\n * @returns Eine Liste aller Registrierungen.\n */\nexport const getRegistrations = async (): Promise<any[]> => {\n    try {\n        const data = await fs.promises.readFile(dataFile, 'utf-8');\n        const lines = data.split('\\n').filter((line) => line.length > 0);\n        return lines.map((line) => JSON.parse(line));\n    } catch (error: any) {\n        if (error.code === 'ENOENT') {\n            return []; // Datei nicht gefunden, leere Liste zurückgeben\n        }\n        console.error('Fehler beim Lesen der Daten:', error);\n        throw new Error('Daten konnten nicht gelesen werden.');\n    }\n};\n\n/**\n * Liest eine einzelne Registrierung anhand ihrer ID.\n * @param id Die ID der zu suchenden Registrierung.\n * @returns Die gefundene Registrierung oder null.\n */\nexport const getRegistrationById = async (id: string): Promise<any | null> => {\n    const registrations = await getRegistrations();\n    return registrations.find((reg) => reg.id === id) || null;\n};\n","/**\n * @copyright Copyright (c) 2025 Christian Silfang\n */\n\nimport { RequestHandler } from \"express\";\nimport nodemailer from \"nodemailer\";\nimport dotenv from \"dotenv\";\nimport { EmailRequestBody } from \"../domain/email.js\";\nimport { saveData } from \"../services/data-service.js\";\n\ndotenv.config();\n\nconst SMTP_SERVER = process.env.SMTP_SERVER || \"\";\nconst SMTP_PORT = parseInt(process.env.SMTP_PORT || \"465\", 10);\nconst SENDER_MAIL = process.env.SENDER_MAIL || \"\";\nconst SENDER_PW = process.env.SENDER_PW || \"\";\n\nconst parseEmailList = (value?: string): string[] => {\n  if (!value) return [];\n  return value\n    .split(/[,;]+/) // avoid errors on \",\" and \";\"\n    .map(addr => addr.trim())\n    .filter(addr => addr.length > 0);\n};\n\nconst isValidEmail = (email: string): boolean => /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(email);\n\nexport const sendEmail: RequestHandler = async (req, res) => {\n  try {\n    const emailData = req.body as EmailRequestBody;\n\n    // E-Mail-Daten speichern\n    await saveData('email-contact', emailData);\n\n    const { to, subject, text, cc, bcc, from } = emailData;\n\n    const toList = parseEmailList(to);\n    const ccList = parseEmailList(cc);\n    const bccList = parseEmailList(bcc);\n\n    if (toList.length === 0 || !toList.every(isValidEmail)) {\n      res.status(400).json({ error: \"Ungültige Empfänger-E-Mail-Adresse.\" });\n      return;\n    }\n\n    if (ccList.length > 0 && !ccList.every(isValidEmail)) {\n      res.status(400).json({ error: \"Ungültige CC-E-Mail-Adresse.\" });\n      return;\n    }\n\n    if (bccList.length > 0 && !bccList.every(isValidEmail)) {\n      res.status(400).json({ error: \"Ungültige BCC-E-Mail-Adresse.\" });\n      return;\n    }\n\n    const transporter = nodemailer.createTransport({\n      host: SMTP_SERVER,\n      port: SMTP_PORT,\n      secure: true,\n      auth: {\n        user: SENDER_MAIL,\n        pass: SENDER_PW,\n      },\n      tls: { rejectUnauthorized: false },\n      socketTimeout: 10000,\n      connectionTimeout: 10000,\n    });\n\n    const mailOptions = {\n      from: from || SENDER_MAIL,\n      to: toList.join(\",\"),\n      cc: ccList.length ? ccList.join(\",\") : undefined,\n      bcc: bccList.length ? bccList.join(\",\") : undefined,\n      subject,\n      html: text,\n    };\n\n    const info = await transporter.sendMail(mailOptions);\n    console.log(\"E-Mail gesendet:\", info.messageId);\n\n    res.status(200).json({\n      message: \"E-Mail erfolgreich gesendet\",\n      messageId: info.messageId,\n      to: toList,\n      cc: ccList,\n      bcc: bccList,\n      subject,\n    });\n  } catch (error: any) {\n    console.error(\"Fehler beim Senden der E-Mail:\", error);\n    res.status(500).json({\n      error: \"Fehler beim Senden der E-Mail\",\n      details: error.message || error.toString(),\n    });\n  }\n};\n","/**\n * @copyright Copyright (c) 2025 Christian Silfang\n */\n\nimport { Router } from 'express';\nimport { sendEmail } from '../controllers/email-controller';\n\nconst router = Router();\n\nrouter.post('/send_email', sendEmail);\n\nexport default router;\n","/**\n * @copyright Copyright (c) 2025 Christian Silfang\n */\n\nimport { RequestHandler } from 'express';\nimport { saveData, getRegistrations, getRegistrationById as getRegistrationByIdFromService } from '../services/data-service.js';\nimport { TripRegisterFormValue, SheetDbRow } from '../domain/registration.js';\n\nconst calculateAge = (birthday: string): number => {\n    const birthDate = new Date(birthday);\n    const today = new Date();\n    let age = today.getFullYear() - birthDate.getFullYear();\n    const m = today.getMonth() - birthDate.getMonth();\n    if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {\n        age--;\n    }\n    return age;\n};\n\nexport const createRegistration: RequestHandler = async (req, res) => {\n    try {\n        const registrationData = req.body as TripRegisterFormValue;\n        const { trip, additionalText, participants } = registrationData;\n\n        if (!trip || !participants || !Array.isArray(participants) || participants.length === 0) {\n            res.status(400).json({ error: 'Die Reise und mindestens ein Teilnehmer sind erforderlich.' });\n            return;\n        }\n\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\n        const { availableBoardings, ...tripWithoutBoardings } = trip;\n\n        const sheetDbRows: SheetDbRow[] = participants.map((participant) => {\n            return {\n                ...tripWithoutBoardings,\n                ...participant,\n                age: calculateAge(participant.birthday),\n                additionalText: additionalText,\n            };\n        });\n\n        const savedRecords = [];\n        for (const row of sheetDbRows) {\n            const savedRecord = await saveData('trip-registration', row);\n            savedRecords.push(savedRecord);\n        }\n\n        res.status(201).json({ message: 'Registrierung erfolgreich gespeichert.', data: savedRecords });\n    } catch (error: any) {\n        console.error('Fehler bei der Erstellung der Registrierung:', error);\n        res.status(500).json({\n            error: 'Fehler bei der Verarbeitung Ihrer Anfrage.',\n            details: error.message,\n        });\n    }\n};\n\nexport const getAllRegistrations: RequestHandler = async (req, res) => {\n    try {\n        const registrations = await getRegistrations();\n        res.status(200).json(registrations);\n    } catch (error: any) {\n        console.error('Fehler beim Abrufen der Registrierungen:', error);\n        res.status(500).json({\n            error: 'Fehler bei der Verarbeitung Ihrer Anfrage.',\n            details: error.message,\n        });\n    }\n};\n\nexport const getRegistrationById: RequestHandler = async (req, res) => {\n    try {\n        const { id } = req.params;\n        const registration = await getRegistrationByIdFromService(id);\n        if (registration) {\n            res.status(200).json(registration);\n        } else {\n            res.status(404).json({ message: 'Registrierung nicht gefunden.' });\n        }\n    } catch (error: any) {\n        console.error('Fehler beim Abrufen der Registrierung:', error);\n        res.status(500).json({\n            error: 'Fehler bei der Verarbeitung Ihrer Anfrage.',\n            details: error.message,\n        });\n    }\n};\n","/**\n * @copyright Copyright (c) 2025 Christian Silfang\n */\n\nimport { Router } from 'express';\nimport {\n    createRegistration,\n    getAllRegistrations,\n    getRegistrationById,\n} from '../controllers/registration-controller.js';\n\nconst router = Router();\n\nrouter.post('/register', createRegistration);\nrouter.get('/register', getAllRegistrations);\nrouter.get('/register/:id', getRegistrationById);\n\nexport default router;\n","/**\n * @copyright Copyright (c) 2025 Christian Silfang\n */\n\nimport cors from 'cors';\nimport 'dotenv/config.js';\nimport express from 'express';\nimport emailRoutes from './routes/email-route.js';\nimport registrationRoutes from './routes/registration-route.js';\nimport dotenv from 'dotenv';\n\ndotenv.config();\n\nconst SMTP_SERVER = process.env.SMTP_SERVER || '';\nconst SMTP_PORT = parseInt(process.env.SMTP_PORT || '465', 10);\nconst SENDER_MAIL = process.env.SENDER_MAIL || '';\nconst SENDER_PW = process.env.SENDER_PW || '';\n\nconst app = express();\n\napp.use(express.json());\napp.use(cors());\n\napp.use('/api', emailRoutes);\napp.use('/api', registrationRoutes);\n\nconst PORT = 3000;\napp.listen(PORT, () => {\n  console.log(`Server läuft auf Port ${PORT}`);\n  console.log(`SMTP Server ${SMTP_SERVER}`);\n  console.log(`SMTP Port ${SMTP_PORT}`);\n  console.log(`Absender Mail-Adresse ${SENDER_MAIL}`);\n  console.log(`Absender Mail-Password ${SENDER_PW}`);\n});\n"],"names":["fs","require$$0","path","require$$1","os","require$$2","crypto","require$$3","version","require$$4","LINE","_debug","message","console","log","_dotenvKey","options","DOTENV_KEY","length","process","env","_instructions","result","dotenvKey","uri","URL","error","code","err","Error","key","password","environment","searchParams","get","environmentKey","toUpperCase","ciphertext","parsed","_vaultPath","possibleVaultPath","Array","isArray","filepath","existsSync","endsWith","resolve","cwd","_resolveHome","envPath","join","homedir","slice","DotenvModule","configDotenv","dotenvPath","encoding","debug","Boolean","lastError","optionPaths","push","parsedAll","parse","readFileSync","populate","e","processEnv","_configVault","_parseVault","vaultPath","keys","split","decrypted","i","attrs","trim","decrypt","config","encrypted","keyStr","Buffer","from","nonce","subarray","authTag","aesgcm","createDecipheriv","setAuthTag","update","final","isRange","RangeError","invalidKeyLength","decryptionFailed","src","obj","match","lines","toString","replace","exec","value","maybeQuote","override","Object","prototype","hasOwnProperty","call","mainModule","exports","assign","DOTENV_CONFIG_ENCODING","DOTENV_CONFIG_PATH","DOTENV_CONFIG_DEBUG","DOTENV_CONFIG_OVERRIDE","DOTENV_CONFIG_DOTENV_KEY","envOptions","re","cliOptions","args","reduce","acc","cur","matches","argv","__filename","fileURLToPath","url","__dirname","dirname","dataDir","dataFile","mkdirSync","recursive","saveData","async","type","data","record","id","randomUUID","timestamp","Date","toISOString","line","JSON","stringify","promises","appendFile","getRegistrations","readFile","filter","map","dotenv","SMTP_SERVER","SMTP_PORT","parseInt","SENDER_MAIL","SENDER_PW","parseEmailList","addr","isValidEmail","email","test","router","Router","post","req","res","emailData","body","to","subject","text","cc","bcc","toList","ccList","bccList","every","status","json","transporter","nodemailer","createTransport","host","port","secure","auth","user","pass","tls","rejectUnauthorized","socketTimeout","connectionTimeout","mailOptions","undefined","html","info","sendMail","messageId","details","calculateAge","birthday","birthDate","today","age","getFullYear","m","getMonth","getDate","registrationData","trip","additionalText","participants","availableBoardings","tripWithoutBoardings","sheetDbRows","participant","savedRecords","row","savedRecord","registrations","params","registration","find","reg","getRegistrationByIdFromService","app","express","use","cors","emailRoutes","registrationRoutes","listen"],"mappings":"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"}